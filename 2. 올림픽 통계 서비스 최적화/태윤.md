# 02. ì˜¬ë¦¼í”½ í†µê³„ ì„œë¹„ìŠ¤ ìµœì í™”

## ğŸ“–Â í•™ìŠµ ìë£Œ

[https://github.com/performance-lecture/lecture-2](https://github.com/performance-lecture/lecture-2)

## âœ¨Â í‚¤ì›Œë“œ

- CSS ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”
- ì»´í¬ë„ŒíŠ¸ ì§€ì—° ë¡œë”©
- ì»´í¬ë„ŒíŠ¸ ì‚¬ì „ ë¡œë”©
- ì´ë¯¸ì§€ ì‚¬ì „ ë¡œë”©

## ğŸ§Â 1. ì½”ë“œ ë¶„ì„

### ğŸ»Â App Component

```jsx
import React, { useState } from 'react'
import styled from 'styled-components'
import Header from './components/Header'
import InfoTable from './components/InfoTable'
import SurveyChart from './components/SurveyChart'
import Footer from './components/Footer'
import ImageModal from './components/ImageModal'

function App() {
  const [showModal, setShowModal] = useState(false)

  return (
    <div className="App">
      <Header />
      <InfoTable />
      <ButtonModal onClick={() => { setShowModal(true) }}>ì˜¬ë¦¼í”½ ì‚¬ì§„ ë³´ê¸°</ButtonModal>
      <SurveyChart />
      <Footer />
      {showModal ? <ImageModal closeModal={() => { setShowModal(false) }} /> : null}
    </div>
  )
}

const ButtonModal = styled.button`
  border-radius: 30px;
  border: 1px solid #999;
  padding: 12px 30px;
  background: none;
  font-size: 1.1em;
  color: #555;
  outline: none;
  cursor: pointer;
`

export default App
```

> ğŸ’¡Â ì»´í¬ë„ŒíŠ¸ í•µì‹¬ ì½”ë“œ
`{showModal ? <ImageModal closeModal={() => { setShowModal(false) }} /> : null}`
> 

### ğŸ»Â ImageModal ì»´í¬ë„ŒíŠ¸

```jsx
import React from 'react'
import styled from 'styled-components'
import ImageGallery from 'react-image-gallery'
import 'react-image-gallery/styles/css/image-gallery.css'
import btnClose from '../assets/btn-close.png'

const ImageModal = (props) => {
  const images = [
    {
      original: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-1/20-08-2016-Football-Men-01.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-1/20-08-2016-Football-Men-01.jpg?interpolation=lanczos-none&resize=*:150',
    },
    {
      original: 'https://stillmed.olympic.org/media/Photos/2016/08/12/12-08-2016-archery-individual-men-03.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/12/12-08-2016-archery-individual-men-03.jpg?interpolation=lanczos-none&resize=*:150',
    },
    {
      original: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-1/20-08-2016-Football-Men-02.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-1/20-08-2016-Football-Men-02.jpg?interpolation=lanczos-none&resize=*:150',
    },
    {
      originl: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-2/20-08-2016-Golf-Women-02.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-2/20-08-2016-Golf-Women-02.jpg?interpolation=lanczos-none&resize=*:150',
    },
    {
      original: 'https://stillmed.olympic.org/media/Photos/2016/08/14/part-1/14-08-2016-Golf-Individual-Stroke-Play-Men-05.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/14/part-1/14-08-2016-Golf-Individual-Stroke-Play-Men-05.jpg?interpolation=lanczos-none&resize=*:150',
    },
    {
      original: 'https://stillmed.olympic.org/media/Photos/2016/08/12/12-08-2016-archery-individual-men-02.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/12/12-08-2016-archery-individual-men-02.jpg?interpolation=lanczos-none&resize=*:150',
    },
    {
      original: 'https://stillmed.olympic.org/media/Photos/2016/08/12/12-08-2016-archery-individual-men-01.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/12/12-08-2016-archery-individual-men-01.jpg?interpolation=lanczos-none&resize=*:150',
    },
    {
      original: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-1/20-08-2016-Football-Men-03.jpg?interpolation=lanczos-none&resize=*:800',
      thumbnail: 'https://stillmed.olympic.org/media/Photos/2016/08/20/part-1/20-08-2016-Football-Men-03.jpg?interpolation=lanczos-none&resize=*:150',
    },
  ]

  return (
		<ImageModalWrapper>
			<ImageModalContainer>
				<BtnClose src={btnClose} onClick={props.closeModal} />
				<ModalHeader>ì˜¬ë¦¼í”½ ì‚¬ì§„</ModalHeader>
				<Modalbody>
					<ImageGallery items={images} />
				</Modalbody>
			</ImageModalContainer>
		</ImageModalWrapper>
  )
}

const ImageModalWrapper = styled.div`
  display: flex;
  justify-content: center;
  align-items: center;
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100vh;
  background: rgba(0,0,0,0.5);
  z-index: 200;
`
const ImageModalContainer = styled.div`
  width: 100%;
  max-width: 700px;
  margin: auto;
  overflow: auto;
  background: #fff;
  border-radius: 8px;
  box-sizing: border-box;
  position: relative;
`
const BtnClose = styled.img`
  cursor: pointer;
  position: absolute;
  z-index: 250;
  width: 25px;
  top: 18px;
  right: 15px;
`
const ModalHeader = styled.div`
  width: 100%;
  padding: 20px 10px;
  border-bottom: 1px solid #dddddd;
  color: #333;
  font-size: 1.05em;
  font-weight: 500;
	box-sizing: border-box;
`
const Modalbody = styled.div`
	width: 100%;
	padding: 10px;
	box-sizing: border-box;
`

export default ImageModal
```

> ğŸ’¡Â ì»´í¬ë„ŒíŠ¸ í•µì‹¬ ì½”ë“œ
> 
> 1. react-image-gallary ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
> 2. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ë„˜ê²¨ í™”ë©´ì— í‘œì‹œ

### ğŸ»Â Bar ì»´í¬ë„ŒíŠ¸

```jsx
import React from 'react'
import styled from 'styled-components'

const Bar = (props) => {
  return (
    <BarWrapper onClick={props.handleClickBar} isSelected={props.isSelected}>
      <BarInfo>
        <Percent>{props.percent}%</Percent>
        <ItemVaue>{props.itemValue}</ItemVaue>
        <Count>{props.count}</Count>
      </BarInfo>
      <BarGraph width={props.percent} isSelected={props.isSelected}></BarGraph>
    </BarWrapper>
  )
}

const BarWrapper = styled.div`
  position: relative;
  margin-bottom: 3px;
  padding: 8px 0;
  background: ${({isSelected}) => isSelected ? '#dddddd' : '#f3f3f3'};
`
const BarInfo = styled.div`
  width: 100%;
  display: flex;
  z-index: 2;
  position: relative;
`
const Percent = styled.span`
  text-align: right;
  min-width: 70px;
  flex: 0 0 auto;
`
const ItemVaue = styled.span`
  padding-left: 60px;
  flex: 1 1 0%;
`
const Count = styled.span`
  padding-right: 20px;
  flex: 0 0 auto;
`
const BarGraph = styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: ${({width}) => width}%;
  transition: width 1.5s ease;
  height: 100%;
  background: ${({isSelected}) => isSelected ? 'rgba(126, 198, 81, 0.7)' : 'rgb(198, 198, 198)'};
  z-index: 1;
`

export default Bar
```

> ğŸ’¡Â ì»´í¬ë„ŒíŠ¸ í•µì‹¬ ì½”ë“œ
> 
> 
> BarGraph (styled-components) width ì†ì„±ê³¼ transition ì†ì„±
> 

## ğŸ¦‹Â 2. ì• ë‹ˆë©”ì´ì…˜ ìµœì í™”

### ğŸ»Â ë¬¸ì œ ì •ì˜

ë§‰ëŒ€ ê·¸ë˜í”„ì˜ ì• ë‹ˆë©”ì´ì…˜ì´ ë¶€ë“œëŸ½ê²Œ ëŠ˜ì–´ë‚˜ì§€ ì•Šê³  ì–´ë”˜ê°€ ì‚´ì§ ëŠê¸°ëŠ” ë“¯í•œ ëŠë‚Œì´ ìˆìŒ

â†’ ì´ëŸ¬í•œ ëŠê¸°ëŠ” í˜„ìƒì„ `ìŸí¬` ë¼ê³  í•¨

### ğŸ»Â ì• ë‹ˆë©”ì´ì…˜ì˜ ë™ì‘ ì›ë¦¬

ì• ë‹ˆë©”ì´ì…˜ì˜ ë™ì‘ ì›ë¦¬

- ì—¬ëŸ¬ ì¥ì˜ ì´ë¯¸ì§€ë¥¼ ë¹ ë¥´ê²Œ ì „í™˜í•˜ì—¬ ì—°ì†ëœ ì´ë¯¸ì§€ê°€ ì›€ì§ì´ëŠ” ê²ƒì²˜ëŸ¼ ëŠê»´ì§€ê²Œ í•˜ëŠ” ê²ƒ

ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” 60Hzì˜ ë””ìŠ¤í”Œë ˆì´ëŠ” 1ì´ˆì— 60ì¥ì˜ ì •ì§€ëœ í™”ë©´ì„ ë¹ ë¥´ê²Œ ë³´ì—¬ì¤Œ.

ë¸Œë¼ìš°ì €ë„ ì´ì— ë§ì¶° 1ì´ˆì— 60ì¥ì˜ í™”ë©´ì„ ìƒˆë¡œ ê·¸ë ¤ì•¼ í•˜ì§€ë§Œ ì˜ˆë¥¼ ë“¤ì–´ CPUê°€ ë°”ë¹ ì„œ ì´ˆë‹¹ 60ì¥ì´ ì•„ë‹Œ 40ì¥ì„ ê·¸ë¦¬ê²Œ ë˜ë©´ ëŠê¸°ëŠ” ë“¯í•œ ìŸí¬ í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

### ğŸ»Â ë¸Œë¼ìš°ì € ë Œë”ë§ ê³¼ì •

DOM + CSSOM > ë Œë” íŠ¸ë¦¬ > ë ˆì´ì•„ì›ƒ > í˜ì¸íŠ¸ > ì»´í¬ì§€íŠ¸

- ì£¼ìš” ë Œë”ë§ ê²½ë¡œ (Critical Rendering Path)
- í”½ì…€ íŒŒì´í”„ë¼ì¸ (Pixel Pipeline)

1. DOM + CSSOM
    
    HTML / CSS ë¦¬ì†ŒìŠ¤ë¥¼ ë‹¤ìš´ë¡œë“œ
    
    HTML parsing â†’ DOM
    
    CSS parsing â†’ CSSOM
    
    â†’ íŠ¸ë¦¬ í˜•íƒœë¡œ êµ¬ì„±
    

1. ë Œë” íŠ¸ë¦¬
    
    DOM + CSSOMì„ í†µí•´ ë Œë” íŠ¸ë¦¬ë¥¼ ìƒì„±
    
    ê° ìš”ì†Œë“¤ì˜ ë ˆì´ì•„ì›ƒì„ ê³„ì‚°í•˜ëŠ” ë° ì‚¬ìš©
    

1. ë ˆì´ì•„ì›ƒ
    
    í™”ë©´ êµ¬ì„± ìš”ì†Œì˜ ìœ„ì¹˜ë‚˜ í¬ê¸°ë¥¼ ê³„ì‚°í•˜ê³ , í•´ë‹¹ ìš°ì¹˜ì— ìš”ì†Œë¥¼ ë°°ì¹˜
    

1. í˜ì¸íŠ¸
    
    ìš”ì†Œì— ìƒ‰ì„ ì±„ì›Œ ë„£ëŠ” ì‘ì—…
    

1. ì»´í¬ì§€íŠ¸ (composite)
    
    ë¸Œë¼ìš°ì €ëŠ” í™”ë©´ì„ ê·¸ë¦´ ë•Œ ì—¬ëŸ¬ ê°œì˜ ë ˆì´ì–´ë¡œ í™”ë©´ì„ ìª¼ê°œ ê·¸ë¦¬ëŠ”ë°
    
    ì»´í¬ì§€íŠ¸ì—ì„œ ì´ ë ˆì´ì–´ë“¤ì„ í•©ì„±í•¨
    

** Performance íŒ¨ë„ì—ì„œ ë©”ì¸ ìŠ¤ë ˆë“œì˜ ì‘ì—…ì„ ì‚´í´ë³´ë©´ ë¸Œë¼ìš°ì € ë Œë”ë§ ê³¼ì •ì„ ë³¼ ìˆ˜ ìˆìŒ.

### ğŸ»Â ë¦¬í”Œë¡œìš°ì™€ ë¦¬í˜ì¸íŠ¸

ë¦¬í”Œë¡œìš°

- ìš”ì†Œì˜ í¬ê¸°ë‚˜ ìœ„ì¹˜ê°€ ë°”ë€” ë•Œ ë°œìƒ

ë¦¬í˜ì¸íŠ¸

- ìƒ‰ìƒì´ë‚˜ ì „ì²´ ìŠ¤íƒ€ì¼ë§Œ ë°”ë€” ë•Œ ë°œìƒ

â‡’ ì£¼ìš” ë Œë”ë§ ê²½ë¡œë¥¼ ë‹¤ì‹œ ê·¸ë¦¬ê²Œ ë¨

ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ìš”ì†Œì˜ ë„ˆë¹„ì™€ ë†’ì´ê°€ ë³€ê²½í–ˆë‹¤ê³  í•˜ë©´ CSSOMì„ ë‹¤ì‹œ ë§Œë“¤ì–´ì•¼ í•˜ë©°,

ì´ëŠ” ìƒˆë¡œìš´ ë Œë” íŠ¸ë¦¬ë¥¼ ìƒì„±í•˜ê³ , ë ˆì´ì•„ì›ƒ / í˜ì¸íŠ¸ / ì»´í¬ì§€íŠ¸ë¥¼ í•˜ê²Œ ëœë‹¤.

â‡’ ìš”ì†Œì˜ í¬ê¸°ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì€ ë¸Œë¼ìš°ì € ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì‚¬ìš©í•¨

### ğŸ»Â í•˜ë“œì›¨ì–´ ê°€ì† (GPU ê°€ì†)

ë¦¬í”Œë¡œìš°ì™€ ë¦¬í˜ì¸íŠ¸ë¥¼ í”¼í•˜ê¸° ìœ„í•´ transform, opacityì™€ ê°™ì€ ì†ì„±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

â†’ í•´ë‹¹ ìš”ì†Œë¥¼ ë³„ë„ì˜ ë ˆì´ì–´ë¡œ ë¶„ë¦¬í•˜ê³  ì‘ì—…ì„ GPUì— ìœ„ì„í•  ìˆ˜ ìˆìŒ

íŠ¹ì • ìš”ì†Œì— í•˜ë“œì›¨ì–´ ê°€ì†ì„ ì‚¬ìš©í•˜ë ¤ë©´ ìš”ì†Œë¥¼ ë³„ë„ ë ˆì´ì–´ë¡œ ë¶„ë¦¬í•˜ê³  GPUë¡œ ë³´ë‚´ì•¼ í•¨

```jsx
const BarGraph = styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: ${({width}) => width}%;
  transition: width 1.5s ease;
  height: 100%;
  background: ${({isSelected}) => isSelected ? 'rgba(126, 198, 81, 0.7)' : 'rgb(198, 198, 198)'};
  z-index: 1;
`
```

```jsx
const BarGraph = styled.div`
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  transform: scaleX(${({width}) => width / 100})
  transform-origin: center left;
  transition: width 1.5s ease;
  height: 100%;
  background: ${({isSelected}) => isSelected ? 'rgba(126, 198, 81, 0.7)' : 'rgb(198, 198, 198)'};
  z-index: 1;
`
```

## ğŸ—‚ï¸Â 3. ì»´í¬ë„ŒíŠ¸ ì§€ì—° ë¡œë”©ê³¼ ì‚¬ì „ ë¡œë”©

### ğŸ»Â ë¬¸ì œ ì •ì˜ ë° í•´ê²° ë°©ë²•

1ì¥ê³¼ ë™ì¼í•˜ê²Œ `cra-bundle-ananlyzer` ë¥¼ ì„¤ì¹˜í•˜ê³  ë²ˆë“¤ íŒŒì¼ì„ ë¶„ì„

`App.js`

```jsx
{showModal ? <ImageModal closeModal={() => { setShowModal(false) }} /> : null}
```

`ImageModal.js`

```jsx
import React from 'react'
import styled from 'styled-components'
import ImageGallery from 'react-image-gallery'
import 'react-image-gallery/styles/css/image-gallery.css'
import btnClose from '../assets/btn-close.png'

const ImageModal = (props) => {
	const images = []
  return (
		<ImageModalWrapper>
			<ImageModalContainer>
				<BtnClose src={btnClose} onClick={props.closeModal} />
				<ModalHeader>ì˜¬ë¦¼í”½ ì‚¬ì§„</ModalHeader>
				<Modalbody>
					<ImageGallery items={images} />
				</Modalbody>
			</ImageModalContainer>
		</ImageModalWrapper>
  )
}

export default ImageModal
```

`image-gallery.js` ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” 26KBì´ë©°, `image-gallery`ë¥¼ ì‚¬ìš©í•˜ëŠ” `ImageModal` ì»´í¬ë„ŒíŠ¸ëŠ” ì²« í™”ë©´ì„ ê·¸ë¦´ ë•Œ í•„ìš”í•˜ì§€ ì•ŠìŒ.

```jsx
import { Suspense, lazy } from 'react'

const LazyImageModal = lazy(() => import('./components/ImageModal'))
```

### ğŸ»Â ì§€ì—° ë¡œë”©ì˜ ë‹¨ì 

ì´ˆê¸° ë¡œë”© ì†ë„ë¥¼ ë¹¨ë¼ì§ˆ ìˆ˜ ìˆì§€ë§Œ, ëª¨ë‹¬ì´ ëœ¨ê¸° ì „ê¹Œì§€ ì•½ê°„ì˜ ì§€ì—°ì´ ë°œìƒí•˜ê²Œ ë¨

â†’ ì‚¬ì „ ë¡œë”© (Preloading) ì„ ì‚¬ìš©í•˜ì—¬ ëª¨ë“ˆì´ í•„ìš”í•´ì§€ê¸° ì „ ë¯¸ë¦¬ ë¡œë“œ

### ğŸ»Â ì‚¬ì „ ë¡œë”©

ì‚¬ì „ ë¡œë”©í•˜ëŠ” ì‹œì 

- ì‚¬ìš©ìê°€ ë²„íŠ¼ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë†¨ì„ ë•Œ
- ìµœì´ˆì— í˜ì´ì§€ê°€ ë¡œë“œë˜ê³  ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì˜ ë§ˆìš´íŠ¸ê°€ ëë‚¬ì„ ë•Œ

ì‚¬ìš©ìê°€ ë²„íŠ¼ ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë†¨ì„ ë•Œ

```jsx
function App() {
  const [showModal, setShowModal] = useState(false)

  const handleMouseEnter = () => {
    const component = import('./components/ImageModal')
  }

  return (
    <div className="App">
      <Header />
      <InfoTable />
      <ButtonModal onMouseEnter={handleMouseEnter} onClick={() => { setShowModal(true) }}>ì˜¬ë¦¼í”½ ì‚¬ì§„ ë³´ê¸°</ButtonModal>
      <SurveyChart />
      <Footer />
      {showModal ? <ImageModal closeModal={() => { setShowModal(false) }} /> : null}
    </div>
  )
}
```

ìµœì´ˆì— í˜ì´ì§€ê°€ ë¡œë“œë˜ê³  ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì˜ ë§ˆìš´íŠ¸ê°€ ëë‚¬ì„ ë•Œ

```jsx
function App() {
  const [showModal, setShowModal] = useState(false)
  
  useEffect(() => {
    const component = import('./components/ImageModal')
  }, [])

  return (
    <div className="App">
      <Header />
      <InfoTable />
      <ButtonModal onClick={() => { setShowModal(true) }}>ì˜¬ë¦¼í”½ ì‚¬ì§„ ë³´ê¸°</ButtonModal>
      <SurveyChart />
      <Footer />
      {showModal ? <ImageModal closeModal={() => { setShowModal(false) }} /> : null}
    </div>
  )
}
```

## ğŸ–¼ï¸Â 4. ì´ë¯¸ì§€ ì‚¬ì „ ë¡œë”©

```jsx
const img = new Image()
img.src = `${ì‚¬ì „ë¡œë”©í• _ì´ë¯¸ì§€_ì£¼ì†Œ}`
```

## ğŸ¤”Â ë©´ì ‘ ì§ˆë¬¸

- ë¸Œë¼ìš°ì € ë Œë”ë§ ê³¼ì •ì— ëŒ€í•´ ì„¤ëª…í•´ì£¼ì„¸ìš”
- ë¦¬í”Œë¡œìš° & ë¦¬í˜ì¸íŠ¸ì˜ ì°¨ì´ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”
- ì–´ë–¤ ê²½ìš° GPU ê°€ì†ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ìƒê°í•˜ì‹œë‚˜ìš”?
- ì§€ì—° ë¡œë”©ì˜ ë‹¨ì ê³¼ ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•œ ì „ëµì€ ë¬´ì—‡ì¸ê°€ìš”?