# 3. 홈페이지 최적화

## 이미지 사이즈 최적화

### 느린 이미지 로딩 분석

- 이미지 포맷 종류: PNG, JPG(JPEG), WebP
    - PNG: 무손실 압축 방식으로 원본을 훼손 없이 압축하며 알파 채널(=투명도)을 지원하는 이미지 포맷
    - JPG: PNG와 다르게 압축 과정에서 정보 손실이 발생한다. 그러나 그만큼 이지미를 더 작은 사이즈로 줄일 수 있다.
    - WebP: 무손실 압축과 손실 압축을 모두 제공하는 최신 이미지 포맷. PNG, JPG에 비해 더 효율적으로 이미지 압축이 가능하다. 하지만 브라우저 호환성 문제가 있다.
        - 브라우저 호환성 문제 때문에 img 태그가 아니라 picture 태그를 사용해야 한다. picture 태그는 다양한 타입의 이미지를 렌터링하는 컨테이너로 사용된다.
- Squoosh: 이미지 변환 컨버터

## 동영상 최적화

### 동영상 콘텐츠 분석

- WebM: 동영상 확장자
- 패턴과 필터를 이용해 낮은 동영상 화질을 보완할 수 있음

## 폰트 최적화

- FOUT: Edge 브라우저에서 폰트를 로드하는 방식. 폰트의 다운로드 여부와 상관없이 먼저 텍스트를 보여준 후 폰트가 다운로드 되면 그때 폰트를 적용하는 방식
- FOIT:  폰트가 완전히 다운로드되기 전까지 텍스트 자체를 보여주지 않는 방식
1. 폰트 적용 시점 제어하기
    
    font-display 속성을 이용하면 폰트가 적용되는 시점을 제어할 수 있다.
    
    갑자기 폰트가 나타나면 어색하기 때문에 fontfaceobserver 라이브러리를 통해 폰트 다운로드 시점을 알고, 페인트 인 애니메이션을 적용하면 된다.
    
2. 폰트 파일 크기 줄이기
    - 폰트 포맷 변경하기
        
        TTF 포맷은 파일 크기가 매우 크다. 따라서 WOFF를 적용해야 웹에서 더욱 빠르게 폰트가 로드 될 수 있다.
        
    - 서브셋 폰트 사용
        
        서브셋 폰트: 모든 문자가 아닌 일부 문자의 폰트 정보만 가지고 있는 것
        
    - 폰트를 파일 형태가 아닌 Data-URI 형태로 CSS 파일에 포함하기
        
        Data-URI: data 스킴이 접두어로 붙은 문자열 형태의 데이터이다. 쉽게 말해 파일을 문자열 형태로 변환하여 문서(HTML,CSS, JS 등)에 인라인으로 삽입하는 것 이다.
        

## 캐시 최적화

- 캐시의 종류
    - 메모리 캐시: 메모리에 저장하는 방식.
    - 디스크 캐시: 파일 형태로 디스크에 저장하는 방식.

브라우저가 캐시를 하기 위해서는 Cache-Control이라는 헤더가 응답 헤더에 있어야 한다.

### Cache-Control

리소스의 응답 헤더에 설정되는 헤더.

- no-cahce: 캐시를 사용하기 전 서버에 검사 후 사용
- no-store: 캐시 사용 안 함
- public: 모든 환경에서 캐시 사용 가능
- private: 브라우저의 환경에서만 캐시 사용, 외부 캐시 서버에서는 사용 불가
- max-age: 캐시의 유효 시간

캐시는 서버의 응답 헤더에서 설정할 수 있음

### 적절한 캐시 유효 시간

리소스마다 사용이나 변경 빈도가 달라 캐시의 유효 시간이 달라져야 효과적임. 

HTML은 일반적으로 no-cache. JS나 CSS는 파일명에 해시를 함께 가지고 있음. 즉, 코드가 변경되면 해시도 변경되어 완전히 다른 파일이 됨. 따라서 캐시를 아무리 오래 적용해도 HTML만 최신상태라면 JS나 CSS 파일은 최신 리소스를 로드 할 것임.

## 불필요한 CSS 제거

- PurgeCSS: 사용하지 않는 CSS를 제거해주는 툴. 파일에 들어있는 모든 키워드를 추출하여 해당 키워드를 이름으로 갖는 CSS 클래스만 보존하고 나머지 매칭되지 않는 클래스는 모두 지우는 방식으로 CSS 파일을 최적화함.
